<!-- see http://www.w3.org/TR/2dcontext -->
<!-- or http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#pixel-manipulation -->
<!-- or https://developer.mozilla.org/en/Canvas_tutorial:Basic_animations -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
<title>Canvas Wipes &amp; Dissolves</title>

<style type="text/css">
#ph_drawing, #photo {
/*	position: absolute;
	top: 0;
	left: 0; */
	width: 600px;
	height: 400px;
	border: 1px #000 solid;
}
#photo { display:none; }
/*#ph_drawing { background-image: url(drawing.jpg); }*/
#drawing_src { display:none; width: 600px; height: 400px; }
</style>

<script type="text/javascript">
var drawing = false;
var ph_drawing, dr_ctx, photo, ph_ctx;
var pts_source = new Array();
var pts_dest = new Array();
var dunnit = false;
var mytimer, ev, ev2;

function init() {
	ph_drawing = document.getElementById('ph_drawing');
	dr_ctx  = ph_drawing.getContext('2d');
	photo   = document.getElementById('photo');

	drawing_src = document.getElementById("drawing_src");
	dr_ctx.drawImage(drawing_src, 0, 0);
}
function init_bitblit() {
	pts_source = [ photo, 600, 400, 30, 0, 4 ];
	pts_dest   = [ ph_drawing, pts_source[1], pts_source[2], pts_source[3], 0, pts_source[5]];
	if( dunnit ) {
		var src = drawing_src.getAttribute('src');
		drawing_src.setAttribute('src', photo.getAttribute('src'));
		photo.setAttribute('src', src);
	}
	dunnit = true;
	if( mytimer ) { clearInterval( mytimer ); }
}
function wipe_iris() {
	init_bitblit();
	ev = 1;
	mytimer = setInterval( function() {
		if( ev < 200 ) {
			x = pts_source[1] / 2 - ev * pts_source[1] / 400;
			y = pts_source[2] / 2 - ev * pts_source[2] / 400;
			w = (pts_source[1] / 2 - x ) * 2;
			h = (pts_source[2] / 2 - y ) * 2;
			dr_ctx.drawImage( photo, x, y, w, h, x, y, w, h );
			ev += 1;
		} else {
			dr_ctx.drawImage( photo, 0, 0 );
			clearInterval( mytimer );
		}
	}, 1 );
	// WTF only getting effect of last bitblit, not intermediate ones/animation
	// OMG look at this one for clues http://10k.aneventapart.com/Uploads/325/
	// found at http://www.canvasdemos.com/
}
function wipe_random() {
	init_bitblit();
	var grid = new Array();
	for( ev=0; ev<400; ev++) { grid[ev] = ev; }
	ev = 399;
	mytimer = setInterval( function() {
		if( 0 <= ev ) {
			r = Math.floor( Math.random() * ev );
			ev2 = grid[ r ];
			grid[ r ] = grid[ ev ];
			x = (ev2 % 20) * Math.floor( pts_source[1] / 20 );
			y = Math.floor( ev2 / 20 ) * Math.floor( pts_source[2] / 20 );
			w = Math.floor( pts_source[1] / 20);
			h = Math.floor( pts_source[2] / 20);
			dr_ctx.drawImage( photo, x, y, w, h, x, y, w, h );
			ev -= 1;
		} else {
			clearInterval( mytimer );
		}
	}, 1 );
}
function wipe_cross() {
	init_bitblit();
	ev = 1;
	mytimer = setInterval( function() {
		if( ev <= 20 ) {
			w = ev * pts_source[1] / 40 + 1;
			h = ev * pts_source[2] / 40;
			x = 0; y = 0;
			dr_ctx.drawImage( photo, x, y, w, h, x, y, w, h );
			y = pts_source[2] - h;
			dr_ctx.drawImage( photo, x, y, w, h, x, y, w, h );
			x = pts_source[1] - w - 1;
			dr_ctx.drawImage( photo, x, y, w, h, x, y, w, h );
			y = 0;
			dr_ctx.drawImage( photo, x, y, w, h, x, y, w, h );
			ev += 1;
		} else {
			dr_ctx.drawImage( photo, 0, 0 );
			clearInterval( mytimer );
		}
	}, 40);
}
function wipe_assemble() {
	init_bitblit();
	w = pts_source[1] / 40;
	h = pts_source[2] / 8;
	ev = 0;
	mytimer = setInterval( function() {
		if( ev < 40 ) {
			for( ev2=0; ev2<8; ev2++ ) {
				y = ev2 * h;
				if( 0 == ev2 % 2 ) {
					x = ev * pts_source[1] / 40;
				} else {
					x = pts_source[1] - ev * pts_source[1] / 40 - pts_source[1] / 40;
				}
				dr_ctx.drawImage( photo, x, y, w, h, x, y, w, h );
			}
			ev += 1;
		} else {
			dr_ctx.drawImage( photo, 0, 0 );
			clearInterval( mytimer );
		}
	}, 10);
}
function wipe_checkerboard() {
	init_bitblit();
	w = Math.floor( pts_source[1] / 10 );
	h = Math.floor( pts_source[2] / 10 );
	ev = 0;
	mytimer = setInterval( function() {
		if( ev < 100 ) {
			ev2 = ev * 2 - (49 < ev ? 99 : 0);
			x = (ev2 % 10) * w + (1 == (Math.floor(ev2 / 10) % 2) ? w : 0)
				- (1 == (Math.floor(ev2 / 10) % 2) && 49 < ev ? 2 * w : 0);
			y = Math.floor(ev2 / 10) * h;
			dr_ctx.drawImage( photo, x, y, w, h, x, y, w, h );
			ev += 1;
		} else {
			clearInterval( mytimer );
		}
	}, 10);
	/*for( ev=0; ev<100; ev++ ) {
		//dr_ctx.save();
		ev2 = ev * 2 - (49 < ev ? 99 : 0);
		x = (ev2 % 10) * w + (1 == (Math.floor(ev2 / 10) % 2) ? w : 0)
			- (1 == (Math.floor(ev2 / 10) % 2) && 49 < ev ? 2 * w : 0);
		y = Math.floor(ev2 / 10) * h;
		dr_ctx.drawImage( photo, x, y, w, h, x, y, w, h );
		//dr_ctx.restore();
	}*/
}
function wipe_rollup() {
	init_bitblit();
	var roll_h = Math.floor(pts_source[2] / 5); // << 20% height 
	var scr_copy = new Image; scr_copy.src = drawing_src.src;
	x = 0;
	w = pts_source[1];
	h = pts_source[2];
	ev = 1;
	mytimer = setInterval( function() {
		if( ev < h - 1 ) {
			if( ev < roll_h ) {
				// start roll up, pull bottom edge to roll_h
				dr_ctx.drawImage( ph_drawing,
					x, h - (ev + ev - 1), w, ev,
					x, pts_source[2] - (ev + ev + 1), w, ev
				);
				dr_ctx.drawImage( drawing_src,
					x, h - (ev + 1), w, 1,
					x, h - (ev + 1), w, 1
				);
				dr_ctx.drawImage( photo,
					x, h - ev, w, 1,
					x, h - ev, w, 1
				);
			} else if( ev > (h - roll_h)) {
				// hit top of screen, gradually remove remaining roll
				dr_ctx.drawImage( ph_drawing,
					x, 2, w, (h - ev - 1),
					x, 0, w, (h - ev - 1)
				);
				dr_ctx.drawImage( scr_copy,
					x, h - ev - 1, w, 1,
					x, h - ev - 1, w, 1
				);
				dr_ctx.drawImage( photo,
					x, h - ev, w, 1,
					x, h - ev, w, 1
				);
			} else {
				// lifted portion can roll unto itself
				dr_ctx.drawImage( ph_drawing,
					x, h - ev - roll_h + 2, w, roll_h - 1,
					x, h - ev - roll_h, w, roll_h - 1
				);
				dr_ctx.drawImage( scr_copy,
					x, h - ev - 1, w, 1,
					x, h - ev - 1, w, 1
				);
				dr_ctx.drawImage( photo,
					x, h - ev, w, 1,
					x, h - ev, w, 1
				);
			}
			ev += 1;
		} else {
			dr_ctx.drawImage( photo, 0, 0 );
			clearInterval( mytimer );
		}
	}, 10);
}
function wipe_rolldown() {
	init_bitblit();
	var roll_h = Math.floor(pts_source[2] / 5); // << 20% height 
	x = 0;
	w = pts_source[1];
	h = pts_source[2];
	ev = 1;
	mytimer = setInterval( function() {
		if( ev < h - 1) {
			if( ev < roll_h ) {
				// start roll down
				dr_ctx.drawImage( ph_drawing, x, 0, w, ev, x, 2, w, ev);
				dr_ctx.drawImage( photo, x, ev * 2 + 1, w, 1, x, 1, w, 1);
				dr_ctx.drawImage( photo, x, ev * 2 + 2, w, 1, x, 0, w, 1);
			} else if( ev >= roll_h && ev < (h - roll_h - 1)) {
				// unroll
				dr_ctx.drawImage( ph_drawing,
					x, ev - roll_h, w, roll_h - 1,
					x, ev - roll_h + 2, w, roll_h - 1
				);
				dr_ctx.drawImage( photo,
					x, ev + roll_h + 1, w, 1,
					x, ev - roll_h + 1, w, 1
				);
				dr_ctx.drawImage( photo,
					x, ev - roll_h, w, 1,
					x, ev - roll_h, w, 1
				);
			} else {
				// getting to bottom of screen, unroll tail of image
				y = h - ev;
				dr_ctx.drawImage( ph_drawing,
					x, ev - y + 1, w, y - 1,
					x, ev - y + 3, w, y - 1
				);
				dr_ctx.drawImage( photo,
					x, ev - y, w, 2,
					x, ev - y, w, 2
				);
			}
			ev += 1;
		} else {
			dr_ctx.drawImage( photo, 0, 0 );
			clearInterval( mytimer );
		}
	}, 5);
}
function wipe_cover() {
	init_bitblit();
	ev = 1;
	mytimer = setInterval( function() {
		if( ev < pts_source[2] ) {
			dr_ctx.drawImage( photo, 0, pts_source[2]-ev, pts_source[1], ev,
				0, 0, pts_source[1], ev );
			ev += 1;
		} else {
			dr_ctx.drawImage( photo, 0, 0 );
			clearInterval( mytimer );
		}
	}, 1);
}
function wipe_uncover() {
	init_bitblit();
	ev = 1;
	mytimer = setInterval( function() {
		if( ev < pts_source[2] ) {
			dr_ctx.drawImage( ph_drawing, 0, 1, pts_source[1], pts_source[2] - 1,
				0, 0, pts_source[1], pts_source[2] - 1);
			dr_ctx.drawImage( photo, 0, pts_source[2]-ev, pts_source[1], ev,
				0, pts_source[2] - ev, pts_source[1], ev );
			ev += 1;
		} else {
			dr_ctx.drawImage( photo, 0, 0 );
			clearInterval( mytimer );
		}
	}, 1);
}
function wipe_venetianblind() {
	init_bitblit();
	x = 0;
	w = pts_source[1];
	ev = 0;
	slats = 8;
	h = parseInt(pts_source[2] / slats);
	mytimer = setInterval( function() {
		if( ev < h ) {
			for( ev2 = 0; ev2 < slats; ev2++ ) {
				y = ev2 * h + ev;
				dr_ctx.drawImage( photo, x, y, w, 1, x, y, w, 1);
			}
			ev += 1;
		} else {
			dr_ctx.drawImage( photo, 0, 0 );
			clearInterval( mytimer );
		}
	}, 5);
}
</script>
</head>

<body onload="init()">

<img id="drawing_src" src="http://farm5.static.flickr.com/4153/5095678717_24eb715fdd_z.jpg">
<img id="photo" src="http://farm5.static.flickr.com/4087/5095694273_2730228d16_z.jpg">
<!--
<img id="drawing_src" src="file://c:/tmp/ell-collab_logo-preview6.jpg">
<img id="photo" src="file://c:/tmp/WimbaHome-mockupwnewlogo.png">
-->

<!--<canvas id="photo" width="600" height="400"></canvas>-->
<canvas id="ph_drawing" width="600" height="400"></canvas>

<div style="text-align:right;position:absolute; top:0; right:1em;">
<p><a href="#" onclick="wipe_iris(); return false;">Iris</a></p>
<p><a href="#" onclick="wipe_random(); return false;">Random</a></p>
<p><a href="#" onclick="wipe_cross(); return false;">Cross</a></p>
<p><a href="#" onclick="wipe_assemble(); return false;">Assemble</a></p>
<p><a href="#" onclick="wipe_checkerboard(); return false;">Checkerboard</a></p>
<hr />
<p><a href="#" onclick="wipe_cover(); return false;">Cover</a></p>
<p><a href="#" onclick="wipe_uncover(); return false;">Uncover</a></p>
<p><a href="#" onclick="wipe_venetianblind(); return false;">Venetian blind</a></p>
<p><a href="#" onclick="wipe_rollup(); return false;">Roll up</a></p>
<p><a href="#" onclick="wipe_rolldown(); return false;">Roll down</a></p>
</div>

</body>
</html>
